{"version":3,"sources":["Globe.js","CameraHandler.js","VariableObjects.js","ThreeScene.js","City.js","DataService.js","Main.js","App.js","serviceWorker.js","index.js"],"names":["Globe","scene","mesh","this","host","totalSize","radius","water","addBaseSphere","addNatureLines","applyGeoData","addExtraGeoData","geometry","THREE","material","color","sphere","rotation","y","Math","PI","add","scale","set","self","file","rivers","reefs","forEach","item","geo","geometries","type","drawLines","coordinates","materials","makeMaterial","JSZipUtils","err","fileData","zip","JSZip","loadAsync","then","contents","Object","keys","files","filename","async","content","JSON","parse","features","feature","drawFeature","m","loaded","lakes","glaciated","playas","riversPolygon","bathymetry","json","data","drawGeoJson","morphTargets","side","coordinate","drawCoordinate","biomeColorMap","undefined","length","properties","BIOME","console","log","GBL_STAT","G200_STAT","ECO_NUM","d","earcut","triangles","vertices","holes","dimensions","i","pointA","pointB","pointC","makeFace","arr","distance","distanceTo","point1","point2","point3","sort","a","b","dir","subVectors","normalize","multiplyScalar","mid","x","z","gpsToVector","push","normal","face","faces","lat","long","phi","theta","sphereSize","sin","cos","vertex","point","CameraHandler","container","camera","onMouseDown","event","preventDefault","addEventListener","onMouseMove","onMouseUp","onMouseOut","mousedown","mouseOnDown","clientX","clientY","targetOnDown","target","style","cursor","mouse","zoomDamp","PI_HALF","removeEventListener","onMouseWheel","zoom","wheelDeltaY","onTouchMove","changedTouches","pageX","pageY","window","innerWidth","innerHeight","delta","distanceTarget","position","lookAt","VariableObjects","globe","roadColors","objects","objectMap","textlabels","text","added","removeChild","element","_baseGeometry","is_animated","subgeo","city","object","addPoint","population","id","size","applyMatrix4","makeTranslation","rotateX","cbrt","max","addDom","name","labelPosition","latitude","longitude","matrixAutoUpdate","updateMatrix","mat","linewidth","wireframe","renderOrder","lines","colors","line","waypoint","addVertex","globePoint","start","end","vertexColors","fvertices","Float32Array","fcolors","setAttribute","lng","r","g","getSelected","clicked","selected","detail","callback","raycaster","setFromCamera","intersects","intersectObjects","intersect","detailHtml","createTextLabel","appendChild","className","html","faction","factionData","backgroundColor","setHTML","setParent","updatePosition","div","document","createElement","width","height","innerHTML","top","left","parent","threejsobj","show","copy","coords2d","get2DCoords","pow","classList","remove","vector","project","onMouseover","ThreeScene","onWindowResize","aspect","updateProjectionMatrix","renderer","setSize","frameId","requestAnimationFrame","animate","stop","cancelAnimationFrame","renderScene","cameraHandler","render","antialias","domElement","init","ref","Component","City","$scope","scope","governer","yn","cityType","snapshot","year","scenario","scenarioCity","factions","soldiers","originalName","cityName","mans","floor","garrison","militia","destinies","recruiting","loyalty","silver","food","tax","workers","idle","wall","forces","traits","sub","buildings","weapons","heroes","soldierClasses","nameImage","ai","workerShortage","residence","amount","granary","totalBuildingSize","maxBuildingSize","sqrt","authority","min","mustering","calculateMuster","makeMusterFoodDays","getMusterSoldiers","days","capacity","stat","soldierClass","unit","assignClass","unassignClass","building","making","category","usedArmoury","space","usedStable","cost","job","fn","makeJobs","shift","jobs","exec","delay","makeBlockSize","armoury","getOptions","stable","option","builders","calculateBuildingBonus","wisdom","ret","weapon","mustered","force","origin","morale","foodBonus","irrigation","silverBonus","deposite","foodEarning","annualFoodEarning","silverEarning","annualSilverEarning","consume","DataService","cities","showUnuse","0","activeFactions","region","citiesArray","values","cityMap","snapshotMap","roadMap","era","ancient","classical","medieval","renaissance","lineCoord","getFaction","getScenario","selectScenario","scenarios","fetch","response","entries","road","roads","addLines","interval","setInterval","clearInterval","list","targeted","selectedScenario","selectedFaction","c","area","addData","setTimeout","current","getRoad","Main","handleClose","setState","handleShow","props","state","Button","variant","onClick","Modal","onHide","Header","closeButton","Title","Body","Tabs","defaultActiveKey","Tab","eventKey","title","map","href","App","React","createRef","Boolean","location","hostname","match","ReactDOM","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.33951aac.chunk.js","sourcesContent":["import * as THREE from 'three';\r\nimport * as JSZip from \"jszip\";\r\nimport * as JSZipUtils from \"jszip-utils\";\r\nimport * as earcut from \"earcut\";\r\n\r\nimport rivers from \"./json/rivers_simplify.json\"\r\nimport reefs from \"./json/reefs.json\"\r\nimport lakes from \"./json/lakes.json\"\r\nimport glaciated from \"./json/glaciated.json\"\r\nimport playas from \"./json/playas.json\"\r\nimport bathymetry from \"./json/bathymetry_K_200.json\"\r\nimport riversPolygon from \"./json/earth-rivers-simplify.json\"\r\n\r\n\r\n\r\n\r\nexport default class Globe{\r\n\r\n\tconstructor(scene,mesh){\r\n\t\r\n\t\t\r\n\t\tthis.scene = scene;\r\n\t\t\r\n\t\t//this.host = \"http://localhost:8001\";\r\n\t\tthis.host = \"\";\r\n\t\tthis.totalSize = 0.5;\r\n\t    this.radius = 200*this.totalSize;    \r\n\t    this.water =0x4B76C0;  \r\n\t\t\r\n\t}\r\n\r\n\tinit(){\r\n\t\tthis.addBaseSphere();\r\n\t\tthis.addNatureLines();\r\n\t    this.applyGeoData();\r\n\t    this.addExtraGeoData();\r\n\t}\r\n\t\r\n\t addBaseSphere(){\r\n\t    const geometry = new THREE.SphereGeometry(this.radius-1*this.totalSize, 40, 30)\r\n\t    const material = new THREE.MeshBasicMaterial({ color: this.water     })\r\n\t    const sphere = new THREE.Mesh(geometry, material)\r\n\t    \r\n\t    sphere.rotation.y = Math.PI;\r\n\t    this.scene.add(sphere)\r\n\r\n\t    \r\n\t    this.mesh = new THREE.Mesh(geometry, material);\r\n\t    this.mesh.scale.set( 1.1, 1.1, 1.1 );\r\n\t  }\r\n  \r\n  \r\n  \r\n  addNatureLines(){\r\n \t var self = this;\r\n\t  var arr = [{\r\n\t    \tfile:rivers,\r\n\t    \tcolor:this.water,\r\n\t    \tradius:this.radius+0.1*this.totalSize\r\n\t    },\r\n\t    {\r\n\t    \tfile:reefs,\r\n\t    \tcolor:0x63ABC1,\r\n\t    \tradius:this.radius+0.1*this.totalSize\r\n\t    }];\r\n\t    \r\n\t    \r\n\t    arr.forEach(function(item){\r\n\t\r\n\t        \t  var geo = new THREE.Geometry();\r\n\t\r\n\t        \t  item.file.geometries.forEach(function(geometry) {\r\n\t        \t\t \t\r\n \t\t\t\t\tif(geometry.type === 'LineString'){\r\n\t        \t\t\t  self.drawLines(geo,geometry.coordinates);\r\n\t        \t\t  }\r\n\t        \t\t  \r\n\t        \t\t  if(geometry.type === 'MultiLineString'){\r\n\t        \t\t\tgeometry.coordinates.forEach(function(coordinates){\r\n\t          \t\t\t  self.drawLines(geo,coordinates);  \t\t\t\t\r\n\t        \t\t\t});\r\n\t        \t\t  }\t\r\n\t        \t});\r\n\t        \t\r\n\t        \t  \r\n      \t\tself.scene.add( new THREE.LineSegments(geo, new THREE.LineBasicMaterial({color: item.color})));\r\n\r\n        \t\r\n\t    });\r\n\t  \r\n  }\r\n  \r\n\r\n\t\r\n\t  \r\n  applyGeoData(){\r\n\t\r\n\tvar self = this;\r\n\tvar materials = [\r\n\t\tthis.makeMaterial(0x9F907A),\r\n\t\tthis.makeMaterial(0x0F5C0F),\t\t      \r\n\t\tthis.makeMaterial(0xFFE99E),\r\n\t\tthis.makeMaterial(0x9F907A),\r\n\t\tthis.makeMaterial(0x297229),\r\n\t\tthis.makeMaterial(0x9E8C5B),\r\n\t\tthis.makeMaterial(0x665147),\r\n\t\tthis.makeMaterial(0xFFE6B3),\r\n\t\tthis.makeMaterial(0x74896C), ////dry grassland\r\n\t\tthis.makeMaterial(0xffffff),\r\n\t\tthis.makeMaterial(0x0D490D),// thick forest\r\n\t\tthis.makeMaterial(this.water)\r\n\r\n\t]\r\n\r\n\t\r\n\tJSZipUtils.getBinaryContent(self.host+'json/wwf_terr_ecos.zip', function(err, fileData) {\r\n\t    if(err) {\r\n\t        throw err; // or handle err\r\n\t    }\r\n\r\n\t    var zip = new JSZip();\r\n\t    \r\n\t    zip.loadAsync(fileData).then(function (contents) {\r\n\t        // ...\r\n\t    \t\r\n\t    \t Object.keys(contents.files).forEach(function(filename) {\r\n\t    \t\t zip.file(filename).async('string').then(function(content) {\r\n\r\n\t        \t    \t\r\n\t                \t\r\n\t        \t    \tvar geo = new THREE.Geometry();\r\n\t        \t \t\r\n\t        \t \t\t\r\n\t        \t \t\t\r\n\t        \t \t\tvar data = JSON.parse(content);\r\n\t        \t    \tdata.features.forEach(function(feature){\r\n\t        \t\t\t\tself.drawFeature(feature,geo);\r\n\t        \t\t\t}); \r\n\t        \t    \t\r\n\t        \t    \tvar m = new THREE.Mesh( geo, materials );\r\n\t        \t      \t\r\n\t        \t\t\tself.scene.add(  m);\r\n\t        \t\t\t\r\n\t        \t\t\tself.loaded = true;\r\n\t                });\r\n\t            });\r\n\t    \t \r\n\t    \r\n\t    });\r\n\t});\r\n  }\r\n  \r\n  \r\n  addExtraGeoData(){\r\n  \r\n  \tvar self = this;\r\n\t var jsons = [{\r\n\t    \tfile:lakes,\r\n\t    \tcolor:this.water,\r\n\t    \tradius:this.radius+0.05\r\n\t    },{\r\n\t    \tfile:glaciated,\r\n\t    \tcolor:0xEFF4FF,\r\n\t    \tradius:this.radius+0.5\r\n\t    },{\r\n\t    \tfile:playas,\r\n\t    \tcolor:0xffffff,\r\n\t    \tradius:this.radius+0.1\r\n\t    },{\r\n\t    \tfile:riversPolygon,\r\n\t    \tcolor:this.water,\r\n\t    \tradius:this.radius+0.05\r\n\t    },{\r\n\t    \tfile:bathymetry,\r\n\t    \tcolor:0x1A448B,\r\n\t    \tradius:this.radius+0.05\r\n\t    }];\r\n\t    \r\n\t    jsons.forEach(function(json){\r\n//\t        $.getJSON(json.file, function(data) {\r\n\t\t\t\tvar data = json.file;\r\n\t        \tself.drawGeoJson(json.color,data,json.radius);\r\n\t    \t\t  \r\n//\t        });\r\n\t    \t\r\n\t    });\r\n  }\r\n  \r\n\t  drawGeometry(geometry,geo,color){\r\n\t  \t\r\n\t  \tvar self = this;\r\n  \t      if(geometry.type === 'LineString'){\r\n\t\t\t  self.drawLines(geo,geometry.coordinates);\r\n\t\t  }\r\n\t\t  \r\n\t\t  if(geometry.type === 'MultiLineString'){\r\n\t\t\tgeometry.coordinates.forEach(function(coordinates){\r\n\t\t\t\tself.drawLines(geo,coordinates);  \t\t\t\t\r\n\t\t\t});\r\n\t\t  }\r\n\t  \r\n  \t\t  \r\n\t  \tself.scene.add( new THREE.LineSegments(geo, new THREE.LineBasicMaterial({color: color})));\r\n\t  \r\n\t  }\r\n\t  \r\n\t  makeMaterial(color){\r\n\t\t\r\n\t\tvar ret = new THREE.MeshBasicMaterial({\r\n\t\t        color: color,\r\n\t\t        morphTargets: false,\r\n\t\t        side: THREE.DoubleSide\r\n\t\t      });\r\n\t\t      \r\n\t\treturn ret;\r\n\t}\r\n\t  \r\n   drawGeoJson(color,data,radius){\r\n\r\n\t\tvar self = this;\r\n\t  var geo = new THREE.Geometry();\r\n\t\tvar material =  new THREE.MeshBasicMaterial({\r\n\t        color: color,\r\n\t        morphTargets: false,\r\n\t        side: THREE.DoubleSide\r\n\t      });\r\n\r\n\t\t\r\n\t\tif(data.type===\"GeometryCollection\"){\r\n\t\t\r\n\t\t  \tdata.geometries.forEach(function(geometry){\r\n\t\t  \t\t\r\n\t\t  \t\tif(geometry.type==='MultiPolygon'){\r\n\t\t  \t\t\tgeometry.coordinates.forEach(function(coordinate){\r\n\t\t  \t\t\t\tself.drawCoordinate(geo,coordinate,radius);\r\n\t\t  \t\t\t});\r\n\t\t  \t\t}else{\r\n\t\t  \t\t\t\r\n\t\t  \t\t\tself.drawCoordinate(geo,geometry.coordinates,radius);\r\n\t\t  \t\t\r\n\t\r\n\t\t  \t\t}\r\n\t\t  \t\t\r\n\t\t  \t});\r\n\t\t}\r\n\t\t\r\n\t\r\n\t\r\n\t  \tvar m = new THREE.Mesh( geo, material );\r\n  \t\r\n\t\tthis.scene.add(  m);\r\n  }\r\n  \r\n  drawFeature(feature,geo){\r\n  \tvar self =this;\r\n\tvar biomeColorMap =[\r\n\t\t0,\r\n\t\t1,\r\n\t\t4,\r\n\t\t6,\r\n\t\t4,\r\n\t\t3,\r\n\t\t1,\r\n\t\t4,\r\n\t\t5,\r\n\t\t5,\r\n\t\t5,\r\n\t\t3,\r\n\t\t4,\r\n\t\t2,\r\n\t\t3\r\n\t]\r\n\t\r\n  \tif(feature.geometry !== null){\r\n\t\tif(feature.geometry.coordinates !== undefined){\r\n\t\t\tif(feature.geometry.coordinates.length>0){\r\n\t\t\t\tvar color = 1;\r\n\t\t\t\tif(feature.properties !== undefined){\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(feature.properties.BIOME>=biomeColorMap.length) console.log(feature.properties.BIOME);\r\n\t\t\t\t\tcolor = biomeColorMap[feature.properties.BIOME];\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(feature.properties.BIOME===13){\r\n\t\t\t\t\tif(feature.properties.GBL_STAT === 1){\r\n\t\t\t\t\t\tcolor=7;\r\n\t\t\t\t\t\tif(feature.properties.G200_STAT  ===2){\r\n\t\t\t\t\t\t\tcolor = 3;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(feature.properties.GBL_STAT === 2){\r\n\t\t\t\t\t\tif(feature.properties.G200_STAT  ===3){\r\n\t\t\t\t\t\t\tcolor = 7;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(feature.properties.GBL_STAT === 3){\r\n\t\t\t\t\t\tcolor=3;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(feature.properties.ECO_NUM === 1){\r\n\t\t\t\t\t\tcolor=8;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(feature.properties.ECO_NUM === 3){\r\n\t\t\t\t\t\tcolor=2;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\r\n\t\t\t\t}\r\n\t\t\t\tif(feature.properties.BIOME===4){\r\n\t\t\t\t\tif(feature.properties.GBL_STAT === 1){\r\n\t\t\t\t\t\t//console.log(feature.properties);\r\n\t\t\t\t\t\tif(feature.properties.G200_STAT  ===1){\r\n\t\t\t\t\t\t\tcolor=1;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(feature.properties.GBL_STAT === 2){\r\n\t\t\t\t\t\tcolor=8;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(feature.properties.GBL_STAT === 3){\r\n\t\t\t\t\t\tcolor=10;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\tif(feature.properties.BIOME===98){\r\n\t\t\t\t\tcolor = 11;\r\n\t\t\t\t}\r\n\t\t\t\tif(feature.geometry.type === 'Polygon'){\r\n\t\t\t\t\tself.drawCoordinate(geo,feature.geometry.coordinates,self.radius,color);\r\n\t\t\t\t}\r\n\t\t\t\tif(feature.geometry.type === 'MultiPolygon'){\r\n\t\t\t\t\tfeature.geometry.coordinates.forEach(function(coordinate){\r\n\t\t\t\t\t\tself.drawCoordinate(geo,coordinate,self.radius,color);\r\n\t\t\t\t\t\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n  }\r\n  \r\n     drawCoordinate(geo,coordinate,radius,color){\r\n\t\tvar d = earcut.flatten(coordinate);\r\n  \t\tvar triangles = earcut(d.vertices, d.holes, d.dimensions);\r\n  \t\t\r\n  \t\t\r\n  \t\tvar i = 0;\r\n\r\n  \t\tfor(;i<triangles.length;i+=3){\r\n\r\n\r\n  \t\t\t//create a triangular geometry\r\n  \t\t\tvar pointA = new THREE.Vector3(d.vertices[triangles[i]*2],d.vertices[triangles[i]*2+1],0);\r\n  \t\t\tvar pointB = new THREE.Vector3(d.vertices[triangles[i+1]*2],d.vertices[triangles[i+1]*2+1],0);\r\n  \t\t\tvar pointC = new THREE.Vector3(d.vertices[triangles[i+2]*2],d.vertices[triangles[i+2]*2+1]);\r\n  \t\t\t\r\n  \t\t\tthis.makeFace(geo,pointA,pointB,pointC,radius,color);\r\n  \t\t\t\r\n  \t\t}\r\n  \t\t\r\n\r\n  }\r\n  \r\n  \r\n  \r\n   makeFace(geo,pointA,pointB,pointC,radius,color){\r\n\t  \r\n\t\tvar max =12;\r\n\r\n\t\t\r\n\t   var arr = [{\r\n\t\t   distance:pointA.distanceTo( pointB ),\r\n\t\t   point1:pointA,\r\n\t\t   point2:pointB,\r\n\t\t   point3:pointC\t\t   \r\n\t   },{\r\n\t\t   distance:pointA.distanceTo( pointC ),\r\n\t\t   point1:pointA,\r\n\t\t   point2:pointC,\r\n\t\t   point3:pointB\t\t   \r\n\t   },{\r\n\t\t   distance:pointB.distanceTo( pointC ),\r\n\t\t   point1:pointB,\r\n\t\t   point2:pointC,\r\n\t\t   point3:pointA\t\t   \r\n\t   }]\r\n\t  \r\n\t   arr.sort(function (a, b) {\r\n\t\t  return b.distance - a.distance;\r\n\t\t});\r\n\t   \r\n\t   \r\n\t   if(arr[0].distance > max){\r\n\t\t   \r\n\t\t   var a = arr[0];\r\n\t\t   \r\n\t\t\tvar dir = new THREE.Vector3();\r\n\t\t\t\r\n\t\t\t  dir.subVectors( a.point1, a.point2 ).normalize();\r\n\t\t\t\t\t  \r\n\t\t\t  dir.multiplyScalar(a.distance/2);\r\n\t\t\t  \r\n\t\t\t  var mid = new THREE.Vector3(a.point2.x,a.point2.y,a.point2.z);\r\n\t\t\t  \r\n\t\t\t  mid.add(dir);\r\n\t\t\t  \r\n\t\t\t  this.gpsToVector(geo,a.point1,a.point3,mid,radius,color);\r\n\t\t\t  this.makeFace(geo,a.point1,a.point3,mid,radius,color);\r\n\t\t\t  this.makeFace(geo,a.point2,a.point3,mid,radius,color);\t\r\n\t   }\r\n\t   \r\n\t   else{\r\n\t\t\r\n\t\t\r\n\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\tgeo.vertices.push(  this.gpsToVector(pointA.x,pointA.y,radius));\r\n\t\t\t\tgeo.vertices.push(  this.gpsToVector(pointB.x,pointB.y,radius) );\r\n\t\t\t\tgeo.vertices.push(   this.gpsToVector(pointC.x,pointC.y,radius));\r\n\t\t\r\n\t\t\t\tvar normal = new THREE.Vector3( 0, 1, 0 ); //optional\r\n\t\t\t\t\r\n\t\t\t\t//create a new face using vertices 0, 1, 2\r\n\t\t\t\tvar face = new THREE.Face3( geo.vertices.length-3,geo.vertices.length-2,geo.vertices.length-1,normal,new THREE.Color( 0xffaa00 ),color);\r\n\t\t\r\n\t\t\t//add the face to the geometry's faces array\r\n\t\t\t\tgeo.faces.push( face );\r\n\t\t}\r\n\t  \r\n  }\r\n  \r\n   gpsToVector(lat,long,radius) {\r\n\t\t\r\n\t    var phi = (90 - long) * Math.PI / 180;\r\n\t    var theta = (180 - lat) * Math.PI / 180;\r\n\r\n\t    var sphereSize = radius;\r\n\t\tif(radius !== undefined) sphereSize = radius;\r\n\t\t\r\n\t\t  return new THREE.Vector3(\r\n\t\t\t\t  sphereSize * Math.sin(phi) * Math.cos(theta),\r\n\t\t\t\t  sphereSize * Math.cos(phi),\r\n\t\t\t\t  sphereSize * Math.sin(phi) * Math.sin(theta)\r\n\t\t  );\t\t\r\n\r\n\t}\r\n\t\r\n\tdrawLines(geo,coordinates){\r\n\t  for(var i = 0 ; i<coordinates.length; i++){\r\n\t\t  if(i>0){\r\n\t\t      geo.vertices.push(this.vertex(coordinates[i-1]), this.vertex(coordinates[i]));\r\n\t\t  }  \t\t\t\t  \r\n\t  }\r\n  \t}\r\n  \t\r\n  \tvertex(point,radius) {\r\n\t\tif(point === undefined){\r\n\t\t\tconsole.log(\"point undefined\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t    var phi = (90 - point[1]) * Math.PI / 180;\r\n\t    var theta = (180 - point[0]) * Math.PI / 180;\r\n\r\n\t    var sphereSize = 200.1*this.totalSize;\r\n\t\t\r\n\t    if(radius !== undefined) sphereSize = radius;\r\n\t    \r\n\t\t  return new THREE.Vector3(\r\n\t\t\t\t  sphereSize * Math.sin(phi) * Math.cos(theta),\r\n\t\t\t\t  sphereSize * Math.cos(phi),\r\n\t\t\t\t  sphereSize * Math.sin(phi) * Math.sin(theta)\r\n\t\t  );\t\t\r\n\r\n\t}\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n}\r\n\r\n","export default class CameraHandler{\r\n\r\n\tconstructor(container,camera,mesh){\r\n\t\t\r\n\t\tthis.camera = camera;\r\n\t\tthis.mesh = mesh;\r\n\t\tthis.container = container;\r\n\t\t\r\n\t\tthis.distance = 300;\r\n\t\tthis.distanceTarget = 300;\r\n\t\t\r\n\t\tthis.camera.position.z = this.distance;\r\n\t\t\r\n\t  this.mouse = { x: 0, y: 0 };\r\n\t  this.mouseOnDown = { x: 0, y: 0 };\r\n\t  this.rotation = { x: 0, y: 0 };\r\n\t  this.target = { x: Math.PI*3/2, y: Math.PI / 6.0 };\r\n\t  this.targetOnDown = { x: 0, y: 0 };\r\n\t  \r\n\t  \r\n\r\n\t    this.container.addEventListener('mousedown', this.onMouseDown, false);\r\n\t    this.container.addEventListener('mousewheel', this.onMouseWheel, false);\r\n\t     this.container.addEventListener('mousemove', this.onTouchMove, false);\r\n\t}\r\n\t\r\n\t\r\n  onMouseDown = (event) => { \r\n    event.preventDefault();\r\n    \r\n        this.container.addEventListener('mousemove', this.onMouseMove, false);\r\n    this.container.addEventListener('mouseup', this.onMouseUp, false);\r\n    this.container.addEventListener('mouseout', this.onMouseOut, false);\r\n    \r\n\r\n\tthis.mousedown = true;\r\n    this.mouseOnDown.x = - event.clientX;\r\n    this.mouseOnDown.y = event.clientY;\r\n\r\n    this.targetOnDown.x = this.target.x;\r\n    this.targetOnDown.y = this.target.y;\r\n\r\n    this.container.style.cursor = 'move';\r\n  }\r\n\r\n   onMouseMove = (event) =>  {\r\n   \t//if(this.mousedown){\r\n\t    this.mouse.x = - event.clientX;\r\n\t    this.mouse.y = event.clientY;\r\n\t\r\n\t    var zoomDamp = this.distance/1000;\r\n\t\r\n\t    this.target.x = this.targetOnDown.x + (this.mouse.x - this.mouseOnDown.x) * 0.005 * zoomDamp;\r\n\t    this.target.y = this.targetOnDown.y + (this.mouse.y - this.mouseOnDown.y) * 0.005 * zoomDamp;\r\n\t\r\n\t    this.target.y = this.target.y > this.PI_HALF ? this.PI_HALF : this.target.y;\r\n\t    this.target.y = this.target.y < - this.PI_HALF ? - this.PI_HALF : this.target.y;\r\n   // }\r\n  }\r\n  \r\n  onMouseUp = (event) =>  {\r\n   this.container.removeEventListener('mousemove', this.onMouseMove, false);\r\n    this.container.removeEventListener('mouseup', this.onMouseUp, false);\r\n    this.container.removeEventListener('mouseout', this.onMouseOut, false);\r\n    \r\n  \tthis.mousedown = false;\r\n \r\n    this.container.style.cursor = 'auto';\r\n  }\r\n\r\n   onMouseOut = (event) =>  {\r\n   this.container.removeEventListener('mousemove', this.onMouseMove, false);\r\n    this.container.removeEventListener('mouseup', this.onMouseUp, false);\r\n    this.container.removeEventListener('mouseout', this.onMouseOut, false);\r\n    \r\n  \tthis.mousedown = false;\r\n\r\n  }\r\n  \r\n  onMouseWheel = (event) => {\r\n    event.preventDefault();\r\n    //if (overRenderer) {\r\n      this.zoom(event.wheelDeltaY * 0.1);\r\n    //}\r\n    return false;\r\n  }\r\n  \r\n   onTouchMove = ( event ) =>{\r\n\r\n\t\tvar x, y;\r\n\r\n\t\tif ( event.changedTouches ) {\r\n\r\n\t\t\tx = event.changedTouches[ 0 ].pageX;\r\n\t\t\ty = event.changedTouches[ 0 ].pageY;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tx = event.clientX;\r\n\t\t\ty = event.clientY;\r\n\r\n\t\t}\r\n\r\n\t\tthis.mouse.x = ( x / window.innerWidth ) * 2 - 1;\r\n\t\tthis.mouse.y = - ( y / window.innerHeight ) * 2 + 1;\r\n\r\n\t    \r\n\r\n\t//\tcheckIntersection();\r\n\r\n\t}\r\n  \r\n  \r\n  \r\n  zoom =(delta) =>{\r\n  \tconst zoomMin = 120\r\n  \tconst zoomMax = 300\r\n\r\n    this.distanceTarget -= delta;\r\n    this.distanceTarget = this.distanceTarget > zoomMax ? zoomMax : this.distanceTarget;\r\n    this.distanceTarget = this.distanceTarget < zoomMin  ? zoomMin : this.distanceTarget;\r\n  }\r\n  \r\n  \r\n  render(){\r\n  \r\n  \t\r\n\tthis.rotation.x += (this.target.x - this.rotation.x) * 0.1;\r\n\tthis.rotation.y += (this.target.y - this.rotation.y) * 0.1;\r\n    this.distance += (this.distanceTarget - this.distance) * 0.3;\r\n\r\n    this.camera.position.x = this.distance * Math.sin(this.rotation.x) * Math.cos(this.rotation.y);\r\n    this.camera.position.y = this.distance * Math.sin(this.rotation.y);\r\n    this.camera.position.z = this.distance * Math.cos(this.rotation.x) * Math.cos(this.rotation.y);\r\n\r\n    this.camera.lookAt(this.mesh.position);\r\n  \r\n  }\r\n}\r\n","import * as THREE from 'three';\r\n\r\nexport default class VariableObjects{\r\n\r\n\tconstructor(scene,mesh,globe,container){\r\n  \r\n\t  this.roadColors = {\r\n\t\t  \"normal\":new THREE.Color( 0xAB9B5D),\r\n\t\t  \"water\":new THREE.Color( 0xA2C5FF),\r\n\t\t  \"high\":new THREE.Color( 0x6E6957),\r\n\t\t  \"mountain\":new THREE.Color( 0x82A876),\r\n\t\t  \"desert\":new THREE.Color( 0xECB480) \r\n\t  }\r\n  \r\n  \r\n\t\tthis.scene = scene;\r\n\t\tthis.mesh = mesh;\r\n\t\tthis.globe = globe;\r\n\t\tthis.container = container;\r\n\t\t\r\n\t\tthis.objects =[];\r\n\t\tthis.objectMap = {};\r\n\t\t\t\r\n\t\tthis.totalSize = globe.totalSize;\r\n\t    this.radius =  globe.radius;    \r\n\t    \r\n\t\tthis.textlabels = [];\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\tvertex(point,radius) {\r\n\t\tif(point === undefined){\r\n\t\t\tconsole.log(\"point undefined\");\r\n\t\t\treturn null;\r\n\t\t}\r\n\t    var phi = (90 - point[1]) * Math.PI / 180;\r\n\t    var theta = (180 - point[0]) * Math.PI / 180;\r\n\r\n\t    var sphereSize = 200.1*this.totalSize;\r\n\t\t\r\n\t    if(radius !== undefined) sphereSize = radius;\r\n\t    \r\n\t\t  return new THREE.Vector3(\r\n\t\t\t\t  sphereSize * Math.sin(phi) * Math.cos(theta),\r\n\t\t\t\t  sphereSize * Math.cos(phi),\r\n\t\t\t\t  sphereSize * Math.sin(phi) * Math.sin(theta)\r\n\t\t  );\t\t\r\n\r\n\t}\r\n  \r\n\t\r\n  addData(data) {\r\n \r\n\t  \r\n\t  var self = this;\r\n\t  this.textlabels.forEach(function(text){\r\n\t\t  if(text.added) self.container.removeChild(text.element); \r\n\t  });\r\n\t  \r\n\t  this.textlabels = [];\r\n\t  \r\n\t  if( this._baseGeometry !== undefined){\r\n//\t\t  while (scene.children.length>8)\r\n//\t\t  {\r\n//\t\t\t  scene.remove(scene.children[8]);\r\n//\t\t  }\r\n\t\t  \r\n\t  }\r\n\t  \r\n\t  var  color;\r\n\r\n    this.is_animated = false;\r\n\r\n\r\n\tself.objects = [];\r\n\r\n\r\n    var subgeo = new THREE.Geometry();\r\n    data.forEach(function(city){\r\n        if(city.color === null){\r\n        \tcolor = new THREE.Color(\"#ffffff\");        \t\r\n        }else{\r\n        \tcolor = new THREE.Color(city.color);\r\n        \r\n        }\r\n        \r\n        city.object = self.addPoint(city, city.population, color,subgeo);\r\n        \r\n        self.objects.push(city.object);\r\n        self.objectMap[city.object.id] = city;\t\r\n         \r\n\r\n    });\r\n\r\n      this._baseGeometry = subgeo;\r\n\r\n  }\r\n  \r\n\r\n  \r\n   addPoint(city, size, color, subgeo) {\r\n\r\n\t\r\n\tvar sphereSize = this.radius-0.1*this.totalSize;\r\n\tvar geometry;\r\n\t\r\n\tif(size === 0){\r\n\t\tsphereSize = this.radius+0.1*this.totalSize\r\n\t\tgeometry = new THREE.CylinderGeometry( 0.05*this.totalSize, 0.05*this.totalSize, 0.5*this.totalSize,16  );\r\n\t\t\r\n\t    \r\n\t}else{\r\n\t\t\r\n\t\t\r\n\t\tgeometry = new THREE.BoxGeometry(1*this.totalSize, 1*this.totalSize, 0.3*this.totalSize);\r\n\t\tgeometry.applyMatrix4(new THREE.Matrix4().makeTranslation(0,0,-0.5));\r\n\t}\r\n\t\r\n\t\r\n\r\n\t\r\n\t\r\n    var material = new THREE.MeshBasicMaterial( {color: color} );\r\n\r\n\tvar point = new THREE.Mesh(geometry,material);\r\n\r\n\r\n\tif(size === 0){\r\n\t\r\n\t\tpoint.geometry.rotateX((-90 * Math.PI) / 180);\r\n\t// point.geometry.translate(0,0,-3);\r\n\r\n\t\t\r\n\t}else{\r\n\t    var scale = Math.cbrt(size*this.totalSize)/100;\r\n\t    scale = Math.max( scale, 0.3*this.totalSize );\r\n\t// scale = Math.sqrt(scale);\r\n\t    point.scale.x = scale;\r\n\t    point.scale.y = scale;\r\n\t    point.scale.z = Math.max( scale, 0.8*this.totalSize ); // avoid\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// non-invertible\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// matrix\r\n\t\r\n\t    \r\n\t\r\n\t    for (var i = 0; i < point.geometry.faces.length; i++) {\r\n\t      point.geometry.faces[i].color = color;\r\n\t    }\r\n\t    \r\n\t    \r\n\t    this.addDom(point,city.name,city.labelPosition);\r\n\r\n\t}\r\n\r\n\t\r\n    var phi = (90 - city.latitude) * Math.PI / 180;\r\n    var theta = (180 - city.longitude) * Math.PI / 180;\r\n\r\n    point.position.x = sphereSize * Math.sin(phi) * Math.cos(theta);\r\n    point.position.y = sphereSize * Math.cos(phi);\r\n    point.position.z = sphereSize * Math.sin(phi) * Math.sin(theta);\r\n\r\n    point.lookAt(this.mesh.position);\r\n    \r\n    \r\n    if(point.matrixAutoUpdate){\r\n      point.updateMatrix();\r\n    }\r\n    \r\n    this.scene.add(point);\r\n    \r\n    var geo = new THREE.EdgesGeometry( point.geometry );\r\n    var mat = new THREE.LineBasicMaterial( { color: 0x111111, linewidth: 4 } );\r\n    var wireframe = new THREE.LineSegments( geo, mat );\r\n    wireframe.renderOrder = 1; // make sure wireframes are rendered 2nd\r\n    point.add( wireframe );\r\n    \r\n    return point;\r\n    \r\n  }\r\n  \r\n  addLines(lines) {\r\n\t  \r\n\t  var self = this;\r\n\t  \r\n\t  var geo = new THREE.BufferGeometry();\r\n\r\n\t  var sphereSize = self.radius+0.2*self.totalSize;\r\n\t\r\n\t  var vertices = [];\r\n\t  var colors = [];\r\n\t  \r\n\t  lines.forEach(function(line){\r\n\t\t  \r\n\t\t  if(line.waypoint !== \"\" && line.waypoint !== null){\r\n\t\t\t  var waypoint = JSON.parse(line.waypoint);\r\n\t\t\t  \r\n\t\t\t  for(var i = 0;i<waypoint.length;i++){\r\n\t\t\t\t  if(i === 0){\r\n\t\t\t\t\t  self.addVertex(vertices,colors,self.globePoint(line.start.latitude,line.start.longitude,sphereSize),self.vertex(waypoint[0],sphereSize),line.type);\r\n\t\t\t\t  }else{\r\n\t\t\t\t\t  self.addVertex(vertices,colors,self.vertex(waypoint[i-1],sphereSize),self.vertex(waypoint[i],sphereSize),line.type);\r\n\t\t\t\t  }\r\n\t\t\t  }\r\n\t\t\t  self.addVertex(vertices,colors,self.vertex(waypoint[waypoint.length-1],sphereSize),self.globePoint(line.end.latitude,line.end.longitude,sphereSize),line.type);\r\n\t\t\t  \r\n\t\t\t  \r\n\t\t  }else{\r\n\t\t\t  self.addVertex(vertices,colors,self.globePoint(line.start.latitude,line.start.longitude,sphereSize),self.globePoint(line.end.latitude,line.end.longitude,sphereSize),line.type);\r\n\t\t  }\r\n\t\t  \r\n\r\n\t  });\r\n\t  \r\n\tvar material = new THREE.LineBasicMaterial( {\r\n\t    color: 0xffffff,\r\n\t    vertexColors: THREE.VertexColors\r\n\t} );\r\n  \r\n\t\r\n\tvar fvertices = new Float32Array(vertices);\r\n\tvar fcolors = new Float32Array(colors);\r\n\tgeo.setAttribute( 'position', new THREE.BufferAttribute( fvertices, 3 ) );\r\n\tgeo.setAttribute( 'color', new THREE.BufferAttribute( fcolors, 3 ) );\r\n\t\r\n\t  var mesh  = new THREE.LineSegments(geo, material);\r\n\t\tself.scene.add( mesh);\r\n\t\t\r\n\t\treturn mesh;\r\n\r\n  }\r\n  \r\n   globePoint(lat, lng,sphereSize){\r\n    var phi = (90 - lat) * Math.PI / 180;\r\n    var theta = (180 - lng) * Math.PI / 180;\r\n\r\n    var point = {};\r\n    point.x = sphereSize * Math.sin(phi) * Math.cos(theta);\r\n    point.y = sphereSize * Math.cos(phi);\r\n    point.z = sphereSize * Math.sin(phi) * Math.sin(theta);\r\n    \r\n    return point;\r\n  }\r\n  \r\n    addVertex(vertices,colors,start,end,type){\r\n\t  \r\n\t    vertices.push(start.x);\r\n\t    vertices.push(start.y);\r\n\t    vertices.push(start.z);\r\n\r\n\t    colors.push(this.roadColors[type].r);\r\n\t    colors.push(this.roadColors[type].g);\r\n\t    colors.push(this.roadColors[type].b);\r\n\r\n\t    vertices.push(end.x);\r\n\t    vertices.push(end.y);\r\n\t    vertices.push(end.z);\r\n\r\n\t    colors.push(this.roadColors[type].r);\r\n\t    colors.push(this.roadColors[type].g);\r\n\t    colors.push(this.roadColors[type].b);\r\n\t    \r\n\t}\r\n\t\r\n\tonMouseover(mouse,camera){\r\n\t\t\t \r\n\t\tvar self = this;\r\n\t\t\t// console.log(mouse.x);\r\n\r\n\t \t\t var ret = self.getSelected(mouse,camera,function(clicked,selected){\r\n\t \t\t\tself.detail(selected,camera);\r\n\t \t\t});\r\n\t \t\tif(ret === false){\r\n\t \t\t\tself.detail();\r\n\t \t\t}\r\n\t }\r\n\t \r\n\t  getSelected(mouse,camera,callback){\r\n\t\t \r\n\t\t  var self = this;\r\n\t\t  \r\n\t\t  var raycaster = new THREE.Raycaster();\r\n\t\t  raycaster.setFromCamera( mouse, camera );\r\n\t\t  \r\n\t\t  var intersects = raycaster.intersectObjects( self.objects );\r\n\t\t\r\n\t\t self.clicked = [];\r\n\t\t intersects.forEach( function(intersect){\r\n\t\t \tif(self.objectMap[intersect.object.id] !== undefined){\r\n\t\t \t\tself.clicked.push(self.objectMap[intersect.object.id]);\r\n\t\t \t}\r\n\t\t });\r\n\t\t \r\n\t\t \r\n\t\t if(self.clicked.length>0){\r\n\t\t\t \r\n\t\t\t callback(self.clicked,self.objectMap[intersects[0].object.id]);\r\n\t\t\t \r\n\t\t\t return true;\r\n\t\t }\r\n\t\t \r\n\t\t return false;\r\n\t }\r\n\t \r\n\t \r\n\t   detail(city,camera){\r\n\t\t \t\r\n\t\t  if(this.detailHtml === undefined){\r\n\t\t\t  this.detailHtml = this.createTextLabel();\r\n\t\t\t  \r\n\t\t      this.container.appendChild(this.detailHtml.element);\r\n\t\t  }\t \r\n\t\t  \r\n\t\t  if(city === undefined){\r\n\t\t\t  this.detailHtml.element.className = \"text-hide\";\r\n\t\t\t  return;\r\n\t\t  }\r\n\t\t  \r\n\t\t  this.detailHtml.element.className =\"text-detail\";\r\n\t\t  \r\n\t\t  var html = \"<div><h5>\"+city.name+\"</h5>\";\r\n\t\r\n\t\t  if(city.faction > 0){\r\n\t\t\t  html +=\"<strong>\"+city.factionData.name+\"</strong><br/>\";\r\n\t\r\n\t\t\t  this.detailHtml.element.style.backgroundColor = city.factionData.color;\r\n\t\t  }else{\r\n\t\t\t  this.detailHtml.element.style.backgroundColor = \"#000\";\r\n\t\t\t  \r\n\t\t  }\r\n\t\t  if(city.population > 0){\r\n\t\t\t  html +=\"<span class='glyphicon glyphicon-user'> </span> \"+(city.population);\r\n\t\t  }\r\n\t\t  \r\n\t\t  html \t+=\"</div>\";\r\n\t\r\n\t\t  \r\n\t\t \r\n\t\t\t  \r\n\t\t  this.detailHtml.setHTML(html);\r\n\t\t  this.detailHtml.setParent(city.object);\r\n\t\t  this.detailHtml.updatePosition(true,camera);\r\n\t\r\n\t  }\r\n\t  \r\n\t  \r\n  \tcreateTextLabel() {\r\n  \t\r\n  \t\tvar self =this;\r\n  \t\r\n\t    var div = document.createElement('div');\r\n\t    div.className = 'text-label';\r\n\t    div.style.position = 'absolute';\r\n\t    div.style.width = 100;\r\n\t    div.style.height = 100;\r\n\t    div.innerHTML = \"hi there!\";\r\n\t    div.style.top = -1000;\r\n\t    div.style.left = -1000;\r\n\t    \r\n\t    \r\n\t    return {\r\n\t      element: div,\r\n\t      parent: false,\r\n\t      position: new THREE.Vector3(0,0,0),\r\n\t      added:false,\r\n\t      setHTML: function(html) {\r\n\t        this.element.innerHTML = html;\r\n\t      },\r\n\t      setParent: function(threejsobj) {\r\n\t        this.parent = threejsobj;\r\n\t      },\r\n\t      updatePosition: function(show,camera) {\r\n\t        if(this.parent) {\r\n\t          this.position.copy(this.parent.position);\r\n\t        }\r\n\t        \r\n\t        var coords2d = this.get2DCoords(this.position, camera);\r\n\t        this.element.style.left = coords2d.x + 'px';\r\n\t        this.element.style.top = coords2d.y + 'px';\r\n\t\r\n\t       \r\n\t        if(show!==true){\r\n\t        \tvar distance = this.parent.position.distanceTo(camera.position);\r\n\t\t        \t\r\n\t        \tvar a = this.parent.scale.x / 0.3;\r\n\t        \t\r\n\t        \tif(distance < Math.pow(a,2) * 100){\r\n\t\t        \tthis.element.classList.remove(\"text-hide\");\r\n\t\t        \tif(!this.added) self.container.appendChild(this.element);\r\n\t             \tthis.added  = true;\r\n\t        \t}else{\r\n\t        \t\tthis.element.classList.add(\"text-hide\");\r\n\t        \t\tif(this.added) self.container.removeChild(this.element); \r\n\t             \tthis.added  = false;\r\n\t        \t\t\r\n\t        \t}\r\n\t        \t\r\n\t\t        if(distance> 400){\r\n\t        \t\tthis.element.classList.add(\"text-hide\");\r\n\t        \t\tif(this.added) self.container.removeChild(this.element); \r\n\t             \tthis.added  = false;\r\n\t\t        }\r\n\t\t        \r\n\t        }\r\n\t\r\n\t\t        \t\r\n\t\r\n\t      },\r\n\t      get2DCoords: function(position, camera) {\r\n\t        var vector = position.project(camera);\r\n\t        vector.x = (vector.x + 1)/2 * window.innerWidth;\r\n\t        vector.y = -(vector.y - 1)/2 * window.innerHeight;\r\n\t        return vector;\r\n\t      }\r\n\t    };\r\n\t  } \r\n\t    \r\n\t    \r\n\t  addDom(point,name,labelPosition){\r\n\t\t\tvar text = this.createTextLabel();\r\n\t\t\ttext.setHTML(name);\r\n\t\t\ttext.setParent(point);\r\n\t\t\tthis.textlabels.push(text);\r\n\t\t\tif(labelPosition ==='top'){\r\n\t\t\t\ttext.element.classList.add(\"label-top\")\r\n\t\t\t}\r\n\t\t//\tcontainer.appendChild(text.element);\r\n\t  }\r\n\t \r\n\t render(mouse,camera){\r\n\t\t this.onMouseover(mouse,camera);\r\n\t\t \r\n\t\t for(var i=0; i<this.textlabels.length; i++) {\r\n  \t      \tthis.textlabels[i].updatePosition(false,camera);\r\n    \t }\r\n\t\t \r\n\t\t \r\n\t\t \r\n\t }\r\n\t \r\n\tremove(object){\r\n\t  this.scene.remove(object);\r\n  \t}\r\n\t \r\n\t \r\n\t\r\n}","import React, { Component } from 'react';\r\nimport * as THREE from 'three';\r\n\r\nimport Globe from './Globe.js';\r\nimport CameraHandler from './CameraHandler.js';\r\nimport VariableObjects from './VariableObjects.js';\r\n\r\n\r\n\r\nexport default class ThreeScene extends Component{\r\n  componentDidMount(){\r\n  \r\n  \t//value initialize\r\n    this.loaded = false;\r\n    \r\n    const width = window.innerWidth\r\n    const height = window.innerHeight\r\n    \r\n    //ADD SCENE\r\n    this.scene = new THREE.Scene()\r\n    //ADD CAMERA\r\n    this.camera = new THREE.PerspectiveCamera(30, width / height, 1, 10000);\r\n    \r\n\r\n    //ADD RENDERER\r\n    this.renderer = new THREE.WebGLRenderer({ antialias: true })\r\n    this.renderer.setSize(width, height)\r\n    this.renderer.domElement.style.position = 'absolute';\r\n    \r\n    this.container.appendChild(this.renderer.domElement)\r\n\t\r\n\twindow.addEventListener('resize', this.onWindowResize, false);\r\n\t    \r\n    this.globe = new Globe(this.scene);\r\n    this.globe.init();\r\n    this.mesh = this.globe.mesh;\r\n\r\n\tthis.cameraHandler = new CameraHandler(this.container,this.camera,this.mesh);\r\n\tthis.objects = new VariableObjects(this.scene,this.mesh,this.globe,this.container);\r\n    \r\n\tthis.start()\r\n\t\r\n\t\r\n  }\r\n  \r\n  \r\n\r\n onWindowResize = ( event ) => {\r\n\t  this.camera.aspect = window.innerWidth / window.innerHeight;\r\n\t    this.camera.updateProjectionMatrix();\r\n\r\n\t    this.renderer.setSize( window.innerWidth, window.innerHeight );\r\n  }\r\n  \t\r\ncomponentWillUnmount(){\r\n    this.stop()\r\n    this.container.removeChild(this.renderer.domElement)\r\n  }\r\n  \r\nstart = () => {\r\n    if (!this.frameId) {\r\n      this.frameId = requestAnimationFrame(this.animate)\r\n    }\r\n  }\r\n  \r\nstop = () => {\r\n    cancelAnimationFrame(this.frameId)\r\n  }\r\n  \r\nanimate = () => {\r\n  // this.cube.rotation.x += 0.01\r\n   //this.cube.rotation.y += 0.01\r\n   this.renderScene()\r\n   this.frameId = window.requestAnimationFrame(this.animate)\r\n }\r\n \r\nrenderScene = () => {\r\n\t//this.zoom(this.curZoomSpeed);\r\n\tthis.cameraHandler.render();\r\n    \r\n\r\n\r\n    this.objects.render(this.cameraHandler.mouse,this.camera);\r\n    \r\n    this.renderer.render(this.scene, this.camera);\r\n    \r\n   \r\n}\r\nrender(){\r\n    return(\r\n      <div\r\n        \r\n        ref={(container) => { this.container = container }}\r\n      />\r\n    )\r\n  }\r\n}","\r\nexport default class City{\r\n\tconstructor(city,$scope) {\r\n\t\t\r\n\t\t\r\n\t\tthis.scope = $scope;\r\n\t\tthis.governer = 0;\r\n\t\t\r\n\r\n\t\tthis.id = city.id;\r\n\t\tthis.yn = city.yn;\r\n\t\tthis.cityType = city.type;\r\n\r\n\t\tthis.snapshot = city.snapshot;\r\n\t\tthis.year = city.year;\r\n\t\tthis.scenario = city.scenario;\r\n\t\tthis.scenarioCity = city.scenarioCity;\r\n\r\n\t\tthis.color = city.color;\r\n\t\tthis.faction = city.faction;\r\n\t\tthis.factionData = $scope.factions[city.faction];\r\n\t\tthis.soldiers = city.soldiers;\r\n\t\tthis.population = city.population;\r\n\t\tthis.latitude = city.latitude;\r\n\t\tthis.longitude = city.longitude;\r\n\t\tthis.name = city.name;\r\n\t\tthis.originalName = city.originalName;\r\n\t\tthis.cityName = city.cityName;\r\n\t\tthis.labelPosition = city.labelPosition;\r\n\t\tthis.type = 'city';\r\n\t\t\r\n\t\tthis.mans = Math.floor(this.population/10);\r\n\t\tthis.garrison = this.soldiers;\r\n\t\tthis.militia = this.garrison;\r\n\t\tthis.destinies = [];\r\n\t\tthis.recruiting = 0;\r\n \t\t\r\n\t\tthis.loyalty = (this.faction === 0)?0:70;\r\n\t\tthis.silver = (this.faction === 0)?0:Math.floor(this.population/10);\r\n\t\tthis.food = (this.faction === 0)?0:this.population*2;\r\n\t\tthis.tax = 10;\r\n\t\tthis.workers = 0;\r\n\t\tthis.idle = 0;\r\n\t\tthis.wall = 0;\r\n\t\tthis.forces = [];\r\n\t\tthis.traits = [];\r\n\t\tthis.sub = [];\r\n \t\t//this.mustering = new Mustering(this);\r\n\t\t\r\n\t\tthis.buildings = {};\r\n\t\tthis.weapons = {};\r\n\t\tthis.heroes = [];\r\n\t\tthis.soldierClasses = {};\r\n\t\tthis.nameImage = {};\r\n \t\t\r\n\t\tthis.ai = {workerShortage:false};\r\n\t\t\r\n\t\t\r\n \t\r\n \t\t\t\t\t \t\t\r\n \t\t//this.makeBlockSize();\r\n \t\t\r\n \t\t//this.makeMaxBlockSize();\r\n\t}\r\n\t\r\n\tinitCity(){\r\n\t\tvar self = this;\r\n\t\tif(this.faction ===0){\r\n \t\t\tself.buildings.residence.amount =  Math.floor((this.population/1000)+(this.population%1000===0?0:1));\r\n \t\t\tself.buildings.granary.amount =  1;\r\n \t\t\tself.buildings.silver.amount = 1;\t\t \r\n \t\t}else{\r\n \t\t\tself.buildings.residence.amount =  Math.floor((this.population/1000)+(this.population%1000===0?0:1));\r\n \t\t\tself.buildings.granary.amount =  Math.floor((this.food/1000)+(this.food%1000===0?0:1));\r\n \t\t\tself.buildings.silver.amount = Math.floor((this.silver/1000)+(this.silver%1000===0?0:1));\t \t\t\r\n \t\t}\r\n\t}\r\n\t\r\n\tmakeBlockSize(){\r\n\t\tvar size = 0;\r\n\t\t\r\n\t\t\r\n\t\tthis.totalBuildingSize =  size;\r\n\t}\r\n\t\r\n\tmakeMaxBlockSize(){\r\n\t\tthis.maxBuildingSize =  Math.floor(Math.sqrt(this.population)*2);\r\n\t\t// \t\treturn Math.pow(Math.floor(Math.sqrt(city.population)/10),2) + 10;\r\n\t}\r\n\r\n\tgetRecruitMax(){\r\n\t\tvar city = this;\r\n\t\t\r\n\t\tif(city !== undefined){\r\n\t\t\tvar max = city.population/100;\r\n\t\t\tmax = max*city.loyalty/100;\r\n\t\t\tvar governer = this.scope.heroes[this.governer];\r\n\t\t\tif(governer!==undefined)\r\n\t\t\t\tmax *= 1+0.1*governer.authority;\r\n\t\t\tmax = Math.floor(max);\r\n\t\t\treturn max < (city.mans - city.soldiers)?max:(city.mans - city.soldiers);\r\n\t\t}\r\n\t\t\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t\r\n\taddMusterSilver(amount){\r\n\t\tvar add = Math.min(this.silver,amount);\r\n\t\tthis.mustering.silver+= add;\t\t\r\n\t\t\r\n\t\tthis.calculateMuster();\r\n\t}\r\n\tsubMusterSilver(amount){\r\n\t\tvar sub = Math.min(this.mustering.silver,amount);\r\n\t\tthis.mustering.silver-= sub;\t\t\r\n\t\t\r\n\t\tthis.calculateMuster();\r\n\r\n\t}\r\n\taddMusterFood(amount){\r\n\t\tvar add = Math.min(this.food,amount);\r\n\t\tthis.mustering.food+= add;\r\n\r\n\t\tthis.makeMusterFoodDays();\r\n\t}\r\n\tsubMusterFood(amount){\r\n\t\tvar sub = Math.min(this.mustering.food,amount);\r\n\t\tthis.mustering.food-= sub;\t\t\r\n\r\n\t\tthis.makeMusterFoodDays();\r\n\t}\r\n\t\r\n\tmakeMusterFood(){\r\n\t\r\n\t\t\r\n\t\t\r\n\t\tthis.mustering.food = Math.min(this.food,this.getMusterSoldiers() *10/ 10);\r\n\t\tthis.mustering.days = this.mustering.food*10 / this.getMusterSoldiers();\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\tcheckMuster(){\r\n\t\t\r\n\t\tif(this.mustering.food<=0) return true;\r\n\t\t\t\t\r\n\t\treturn this.getMusterSoldiers() === 0;\r\n\t}\r\n\t\r\n\tgetMusterSoldiers(){\r\n\t\tvar amount = 0;\r\n\t\treturn amount;\r\n\t}\r\n\t\r\n\tcalculateMuster(){\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tthis.mustering.capacity = 0;\r\n\t\t\r\n\t\t\r\n\t\tthis.mustering.food = Math.min(this.food,self.mustering.capacity - self.mustering.silver);\r\n\t\tthis.mustering.days = this.mustering.food*10 / this.getMusterSoldiers();\r\n\t\t\r\n\t}\r\n\t\r\n\tassignClass(type,stat){\r\n\t\t\r\n\t\tvar soldierClass = this.scope.soldierClasses[type];\r\n\t\t\r\n\t\tif(stat === 'organize'){\r\n\t\t\tvar add = Math.min(this.militia,soldierClass.unit);\r\n\t\t\tthis.soldierClasses[type].garrison += add;\r\n\t\t\tthis.militia -= add;\r\n\t\t\t\r\n\t\t\tif(type==='worker'){ \r\n\t\t\t\tthis.workers += add;\r\n\t\t\t\tthis.idle += add;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}else{\r\n\t\t\t\r\n\t\t\tvar garrison = this.soldierClasses[type].garrison;\r\n\t\t\tif(type==='worker'){\r\n\t\t\t\tgarrison = this.idle;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.mustering.assignClass(type,garrison);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tunassignClass(type,stat){\r\n\t\t\r\n\t\tvar soldierClass = this.scope.soldierClasses[type];\r\n\r\n\t\tif(stat === 'organize'){\r\n\t\t\tvar sub = Math.min(this.soldierClasses[type].garrison,soldierClass.unit);\r\n\r\n\t\t\tif(type==='worker'){ \r\n\t\t\t\tsub = Math.min(sub,this.idle);\t\t\t\t\r\n\t\t\t\tthis.workers -= sub;\r\n\t\t\t\tthis.idle -= sub;\r\n\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.soldierClasses[type].garrison -= sub;\r\n\t\t\tthis.militia +=sub;\r\n\r\n\t\t\t\r\n\t\t}else{\r\n\t\t\t\r\n\t\t\tthis.mustering.unassignClass(type);\r\n\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\tmake(building,type){\r\n\t\t\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tvar unit = this.scope.weapons[type].unit;\r\n\t\tthis.weapons[type].making += unit;\r\n\t\tif(this.scope.weapons[type].category === 'weapon'){\r\n\t\t\tthis.usedArmoury += unit * this.scope.weapons[type].space;\r\n\t\t}\r\n\t\tif(this.scope.weapons[type].category === 'livestock'){\r\n\t\t\tthis.usedStable += unit * this.scope.weapons[type].space;\r\n\t\t}\r\n\t\t\r\n\t\tthis.silver -= this.scope.weapons[type].cost * unit;\r\n\t\t\r\n\t\tvar job =  {\r\n\t\t\tfn:function(){\r\n\t\t\t\tself.weapons[type].amount += unit;\r\n\t\t\t\tself.weapons[type].making -= unit;\t\t\t\t\t\t\t\r\n\t\t\t\tbuilding.makeJobs.shift();\r\n\t\t\t\tif(building.makeJobs.length >0){\t\t\t\r\n\t\t\t\t\tself.scope.jobs.push(building.makeJobs[0]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\texec:function(){\r\n\t\t\t\tthis.delay -= building.workers;\r\n\t\t\t\tthis.delay++;\r\n\t\t\t},\r\n\t\t\tdelay:this.scope.weapons[type].delay\r\n\t\t};\r\n\r\n\t\tbuilding.makeJobs.push(job);\r\n\t\t\r\n\t\tif(building.makeJobs.length === 1){\t\t\t\r\n\t\t\treturn job;\r\n\t\t}else{\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\tcalculateBuildingBonus(){\r\n\t\t\r\n\t\tthis.makeBlockSize();\r\n\t\tthis.armoury = this.getOptions('armoury');\r\n\t\tthis.stable = this.getOptions('stable');\r\n\r\n\t\tthis.usedArmoury = 0;\r\n\t\tthis.usedStable = 0;\r\n\r\n\r\n\t\t\t\t\r\n\t}\r\n\t\r\n\tgetOptions(option){\r\n\t\t\r\n\t\tvar ret = 0;\r\n\r\n\t\t\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tbuild(type){\r\n\t\t\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tthis.idle -= this.scope.buildings[type].builders;\r\n\t\tthis.silver -= this.scope.buildings[type].silver;\r\n\r\n\t\tthis.buildings[type].building = true;\r\n\t\t\r\n\t\tvar job =  {\r\n\t\t\tfn:function(){\r\n\t\t\t\tself.buildings[type].amount ++;\r\n\t\t\t\tself.idle += self.scope.buildings[type].builders;\r\n\t\t\t\tself.buildings[type].building = false;\r\n\t\t\t\t\r\n\t\t\t\tself.buildings[type].jobs.shift();\r\n\t\t\t\t\r\n\t\t\t\tself.calculateBuildingBonus();\r\n\r\n\t\t\t},\r\n\t\t\texec:function(){\r\n\t\t\t\t\r\n\t\t\t\tvar delay = self.getOptions('delay');\r\n\t\t\t\tvar wisdom = 0;\r\n\t\t\t\tvar governer = self.scope.heroes[self.governer];\r\n\t\t\t\tif(governer!==undefined)\r\n\t\t\t\t\twisdom = \tgoverner.wisdom;\r\n\t\t\t\tthis.delay -= 1+0.1*wisdom+0.01*delay;\r\n\t\t\t\tthis.delay++;\r\n\t\t\t},\r\n\t\t\tdelay:self.buildings[type].delay\r\n\t\t};\r\n\r\n\t\tthis.totalBuildingSize += this.scope.buildings[type].size;\r\n\r\n\t\tthis.buildings[type].jobs.push(job);\r\n\t\t\r\n\t\treturn job;\r\n\t\t\r\n\t}\r\n\r\n\tcheckMake(building,item){\r\n\t\tvar ret = false;\r\n\t\tvar weapon = this.scope.weapons[item];\r\n\t\tif(weapon.category === 'weapon'){\r\n\t\t\tret= this.usedArmoury+weapon.unit*weapon.space<=this.armoury;\t\t\t\t\t\r\n\t\t}\r\n\t\tif(weapon.category === 'livestock'){\r\n\t\t\tret= this.usedStable+weapon.unit*weapon.space<=this.stable;\r\n\t\t}\r\n\t\t\r\n\t\treturn !(building.workers!==0 && ret && this.silver >= weapon.unit * weapon.cost);\r\n\r\n\t}\r\n\t\t\r\n\tmuster(mustered){\r\n\t\t\r\n\t\t\r\n\t\tvar force = {\r\n\t\t\tfaction:this.faction,\r\n\t\t\tlongitude : this.longitude,\r\n\t\t\tlatitude : this.latitude,\r\n\t\t\ttype :'force',\r\n\t\t\tsoldiers : 0,\r\n\t\t\tname :this.name+' Force',\r\n\t\t\torigin : this,\r\n\t\t\tposition: this,\r\n\t\t\tmorale:this.loyalty,\r\n\t\t\tsoldierClasses : {},\r\n\t\t\tsilver : this.mustering.silver,\r\n\t\t\tfood : this.mustering.food,\r\n\t\t\theroes:{}\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\r\n\t\t\r\n\t\t\r\n\t\tthis.forces.push(force);\r\n\r\n\t\t\r\n\t\treturn force;\r\n\t}\r\n\t\r\n\tinitMustering(){\r\n \t\t\r\n\t\t\r\n\t}\r\n\t\r\n\tannualFoodEarning(){\r\n\t\t\r\n\t\tvar city = this;\r\n\t\tvar ret = 0;\r\n\r\n\t\tvar add = city.getOptions('irrigationBonus');\r\n\t\tvar foodBonus = city.getOptions('foodBonus');\r\n\t\tvar irrigation = city.getOptions('irrigation');\r\n\r\n\t\tret += Math.floor(city.population*city.tax*(0.1+foodBonus*0.001));\r\n\t\tret += irrigation;\r\n\t\t\r\n\t\tif(city.buildings.irrigation !== undefined)\r\n\t\t\tret += city.buildings.irrigation.amount*add;\r\n\t\t\r\n\t\treturn ret;\r\n\r\n\t}\r\n\t\r\n\tannualSilverEarning(){\r\n\r\n\t\tvar city = this;\r\n\r\n\t\tvar ret = 0;\r\n\t\t\r\n\t\tvar silverBonus = city.getOptions('silverBonus');\t\t\t\t\t\t\t\t\t\t\r\n\t\tvar silver = city.getOptions('silver');\r\n\t\t\r\n\t\tret += Math.floor(city.population*city.tax*(0.005+silverBonus*0.00005));\r\n\t\tret += silver;\r\n\t\t\r\n\t\treturn ret;\r\n\t\t\r\n\t}\r\n\t\r\n\tannualJob(){\r\n\t\tvar city = this;\r\n\t\t\r\n\t\tvar granary = city.getOptions('granary');\r\n\t\tvar deposite = city.getOptions('deposite');\r\n\r\n\t\tvar foodEarning = city.annualFoodEarning();\r\n\t\tcity.food += foodEarning;\r\n\r\n\t\t\r\n\t\tvar silverEarning = city.annualSilverEarning();\r\n\t\t\r\n\t\tcity.silver += silverEarning;\r\n\t\t\r\n\t\t\r\n\t\tif(city.food > granary){\r\n\t\t\tcity.food = granary;\r\n\t\t}\r\n\t\t\r\n\t\tif(city.silver > deposite){\r\n\t\t\tcity.silver = deposite;\r\n\t\t}\t\t\t\t\t\r\n\t\t\r\n\t\tif(city.silver<0){\r\n\t\t\tcity.silver = 0\r\n\t\t\tcity.loyalty -=20;\r\n\t\t\tif(city.loyalty <0){\r\n\t\t\t\tcity.loyalty = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t}\r\n\t\r\n\tdailyJob(){\r\n\r\n\t\tif(this.garrison > 0){\r\n\r\n\t\t\tthis.food -= Math.floor((this.garrison+this.workers)/10);\r\n\t\t\t\r\n\t\t\tvar consume = this.getOptions('foodConsume');\r\n\t\t\tthis.food -= consume;\r\n\t\t\t\r\n\t\t\tif(this.food<=0){\r\n\t\t\t\tthis.mans +=(this.garrison+this.workers);\r\n\t\t\t\tthis.garrison = 0;\t\t\t\t\r\n\t\t\t\tthis.workers = 0;\r\n\t\t\t\tthis.idle = 0;\r\n\t\t\t\tthis.food = 0;\r\n\t\t\t\t\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tcheckRecruit(){\r\n\t\t\r\n\t\tvar city = this;\r\n\t\t\r\n\t\tif(city === undefined) return true;\r\n\t\t\r\n\t\tif(city.food <=0){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tif(city.forces === undefined){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tvar ret = false;\r\n\t\tcity.forces.forEach(function(force){\r\n\t\t\tif(force.faction !== city.faction){\r\n\t\t\t\tret = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn ret || city.mans===0 || city.population<100;\r\n\t\t\r\n\t}\r\n\t\r\n}\r\n\r\n","import City from './City.js';\r\n\r\nexport default class DataService{\r\n\tconstructor(scene){\r\n\t\r\n\t\tvar self = this;\r\n\t\r\n\t\r\n\t\t//self.host = \"http://localhost:8001\";\r\n\t\tself.host = \"\";\r\n\r\n\t\tself.scene = scene;\r\n\t\t\r\n\t\tself.cities ={};\r\n\t\tself.showUnuse = false;\r\n\t\tself.factions = {0:{name:'None',id:0}};\r\n\t\tself.activeFactions = {};\r\n\t\tself.region = {};\r\n\t\r\n\t\t \r\n\t\t self.objectMap = {};\r\n\t\t self.objects =[];\r\n\t\t \r\n\t\t self.citiesArray = Object.values(self.cities);\r\n\t\t self.cityMap = {};\r\n\t\t self.snapshotMap = {};\r\n\t\t self.roadMap = {};\r\n\t\t self.era = {ancient:[],classical:[],medieval:[],renaissance:[]};\r\n\t\t \r\n\t\r\n\t\t self.lineCoord = [];\r\n\t \r\n\t\tself.data = [];\r\n\t\t\r\n\t\tself.getFaction(function(){\r\n\t\t\tself.getScenario(function(){\r\n\t\t\t\tself.selectScenario(self.scenarios[0]);\t\t\t\r\n\t\t\t});\r\n\t\t});\r\n\t\t\r\n\t}\r\n\t\r\n\t getScenario(callback){\r\n\t\t  var self = this;\r\n\t\t  \r\n\r\n//\t\t\tself.startLoading();\r\n\t\t\t\r\n\t\t\tfetch(self.host+\"data/scenario\")\r\n\t\t\t.then(response => response.json())\r\n\t\t    .then(data => {\r\n\t\t    \t\r\n\t\t    \tself.scenarios = data;\r\n\t\t    \t\r\n\t\t    \t\r\n\t\t    \tself.scenarios.forEach(function(scenario){\r\n\t\t    \t\tif(scenario.yn){\r\n\t\t\t    \t\tvar era = \"\";\r\n\t\t\t    \t\tif(scenario.year <=-500){\r\n\t\t\t    \t\t\tera =\"ancient\";\r\n\t\t\t    \t\t}else if(scenario.year > -500 && scenario.year <= 500){\r\n\t\t\t    \t\t\tera =\"classical\";\t\t    \t\t\t\r\n\t\t\t    \t\t}else if(scenario.year > 500 && scenario.year <= 1400){\r\n\t\t\t    \t\t\tera =\"medieval\";\t\t    \t\t\t\r\n\t\t\t    \t\t}else if(scenario.year > 1400){\r\n\t\t\t    \t\t\tera =\"renaissance\";\t\t    \t\t\t\r\n\t\t\t    \t\t}\r\n\t\t\t    \t\t\r\n\t\t    \t\t\tself.era[era].push(scenario);\r\n\t\t    \t\t}\r\n\r\n\t\t    \t})\r\n\t\t    \t\r\n\t\t    \tcallback();\r\n\t\t    \t\r\n\t\t    });\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\tgetRoad (scenario){\r\n\t\t\tvar self = this;\r\n\t\t\tfetch(self.host+\"data/road/scenario/\"+scenario)\r\n\t\t\t.then(response => response.json())\r\n\t\t    .then(data => {\t\t    \r\n\t\t    \t\r\n\t\t    \tself.roadMap = {};\r\n\t\t    \t\r\n\t\t    \tvar lines = data;\r\n\t\t    \tObject.entries(lines).forEach(([key, line]) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\tself.roadMap[line.road] = line;\r\n\t\t\t \t});\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tself.lineCoord = [];\r\n\t\t\t\tObject.entries(self.roadMap).forEach(([key, line]) => {\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(self.cities[line.start] !== undefined && self.cities[line.end] !== undefined){\r\n\r\n\t\t\t\t\t\tif(self.cities[line.start].yn && self.cities[line.end].yn){\r\n// line.type ='road';\r\n\t\t\t\t\t\t\tline.destinies = [{road:line,city:self.cities[line.start]},{road:line,city:self.cities[line.end]}];\r\n\t\t\t\t\t\t\tline.forces = [];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tself.cities[line.start].destinies.push({road:line,city:self.cities[line.end]});\r\n\t\t\t\t\t\t\tself.cities[line.end].destinies.push({road:line,city:self.cities[line.start]});\r\n\r\n\t\t\t\t\t\t\tself.lineCoord.push({start:self.cities[line.start],end:self.cities[line.end],waypoint:line.waypoint,type:line.type});\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t \t});\r\n\t\t\t\t\r\n\t\t\t\tself.roads = self.globe.addLines(self.lineCoord);\r\n\r\n\t\t\t\tvar interval = setInterval(function(){ \r\n\t\t\t\t\tif(self.globe.loaded){\r\n//\t\t\t\t\t\tself.closeLoading();\t\t\t\t\t\r\n\t\t\t\t\t\t clearInterval(interval);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 1000);\r\n\t\t    \t\r\n\t\t    });\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\t\t\r\n\tgetFaction(fn){\r\n\t\tvar self = this;\r\n\t\t\r\n\t\tfetch(self.host+\"data/faction\")\r\n\t\t\t.then(response => response.json())\r\n\t\t    .then(data => {\r\n\t    \tvar list = data;\r\n\t    \tObject.entries(list).forEach(([key, faction]) => {\r\n\t\t\t\t\r\n\t\t\t\tfaction.cities = [];\r\n\t\t\t\tfaction.forces = [];\r\n\t\t\t\tfaction.targeted = [];\r\n\t\t\t\t\r\n\t\t\t\tself.factions[faction.id] = faction;\r\n\t\t \t});\r\n\t\t\t\r\n\t\t\tfn();\r\n\t\t\t\r\n\t    \t\r\n\t    });\r\n\t\t\r\n\t}\r\n\t\r\n\t\tselectScenario (scenario){\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\t\t\tself.selectedScenario=scenario;\r\n\t\t\t\r\n\t\t\tself.cities = {};\r\n\t\t\t\r\n\t\t\tself.cityMap = {};\r\n\t\t\tself.snapshotMap = {};\r\n\t\t\tself.cities = {};\r\n\t\t\tself.selectedFaction = 0;\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t\r\n//\t\t\tself.startLoading();\r\n\t\t\t\r\n\t\t\tfetch(self.host+\"data/scenarioCities/\"+scenario.id)\r\n\t\t\t.then(response => response.json())\r\n\t\t    .then(data => {\r\n\t\t    \t\r\n\t\t    \tvar list = data;\r\n\t\t    \tself.data = [];\r\n\t\t    \tself.activeFactions = {};\r\n\t\t    \tself.region = {};\r\n\r\n\t\t    \tObject.entries(list).forEach(([key, city]) => {\r\n\t\t\t \t\t\r\n\t\t\t \t\tvar c = new City(city,self);\r\n\t\t\t \t\t\r\n\t\t\t \t\tself.cities[city.id] = c;\r\n\t\t\t \t\t\r\n\t\t\t \t\t\r\n\t\t\t \t\tself.data.push(c)\r\n\t\t\t \t\t\r\n\t\t\t \t\tself.cityMap[city.id] = c;\r\n\t\t\t \t\tself.snapshotMap[city.snapshot] = c;\r\n\t\t\t \t\t\r\n\r\n\t\t\t \t\tif(self.activeFactions[city.faction] === undefined && city.yn && city.faction !==0){\r\n\t\t\t\t \t\tself.activeFactions[city.faction] = self.factions[city.faction];\t\r\n\t\t\t\t \t\tself.activeFactions[city.faction].cities = [];\r\n\t\t\t\t\t}\r\n\t\t\t \t\tif(self.activeFactions[city.faction] !== undefined && city.yn ){\r\n\t\t\t \t\t\tself.activeFactions[city.faction].cities.push(c);\r\n\t\t\t \t\t}\r\n\t\t\t \t});\r\n\t\t\t \t\r\n\t\t\t \t\r\n\t\t    \tObject.entries(self.activeFactions).forEach(([key, faction]) => {\r\n\r\n\t\t\t \t\tif(faction.region !== null){\r\n\t\t\t \t\t\tif(self.region[faction.region] === undefined){\r\n\t\t\t \t\t\t\tself.region[faction.region] = {};\r\n\t\t\t \t\t\t}\r\n\t\t\t \t\t\tif(self.region[faction.region][faction.area] === undefined){\r\n\t\t\t \t\t\t\tself.region[faction.region][faction.area] = [];\r\n\t\t\t \t\t\t}\r\n\t\t\t \t\t\tself.region[faction.region][faction.area].push(faction);\r\n\t\t\t \t\t}\r\n\t\t\t \t});\r\n\t\t\t \t\r\n\t\t       window.data = self.data;\r\n\t\t       \r\n\t\t       \r\n\t\t       \r\n\t\t       \r\n\t\t       self.addData(scenario);\r\n\t\t       \r\n\t\t       \r\n\r\n\t\t       self.citiesArray = Object.values(self.cities);\r\n\r\n\t\t\t  \t\r\n\t\t       \r\n\t\t\t  \t\r\n\t\t\t  \t\r\n\t\t       \tsetTimeout(function(){\r\n//\t\t       \t\t$('#faction li:first-child a').tab('show');\r\n\t\t       \t},100);\r\n\t\t\t  \t\r\n\t\t\t  \t \r\n\t\t    });\r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\t\r\n\t\taddData(scenario){\r\n\t\t\r\n\t\t\tvar self = this;\r\n\t\t\t\r\n\r\n\t\t\tself.globe = self.scene.current.objects;\r\n\r\n\t\t\tvar data = [];\r\n\r\n\t\t\tif(self.roads !== undefined){\r\n\t\t\t\tself.globe.remove(self.roads);\t\t\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tObject.entries(self.objectMap).forEach(([key, city]) => {\r\n\t\t\t\r\n\t\t\t\tself.globe.remove(city.object);\t\t\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\twindow.data.forEach(function(city){\r\n\t\t\t\t\r\n\t\t\t\tif(self.showUnuse || city.yn){\r\n\t\t\t\t\tdata.push(city);\r\n\t\t\t\t}\t\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tself.globe.addData(data);\r\n\t\t\t\r\n\t\t\tself.objects = [];\r\n\t       data.forEach(function(city){\r\n\t    \t   if(city.object !== undefined){\r\n\t    \t\t   self.objectMap[city.object.id] = city;\t    \t\t   \r\n\t\t    \t   self.objects.push(city.object);\r\n\t    \t   }\r\n\t       });\r\n\t       self.getRoad(scenario.id);\r\n\t       \r\n\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\r\n}","import React, { Component } from 'react';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Modal from 'react-bootstrap/Modal';\r\nimport Tab from 'react-bootstrap/Tab';\r\nimport Tabs from 'react-bootstrap/Tabs';\r\n\r\n\r\nexport default class Main extends Component {\r\n\t\r\n\t\r\n\tconstructor(){\r\n\t\tsuper();\r\n\t\t this.state = {\r\n\t\t      show: false\r\n\t\t    };\r\n\t\t\r\n\t\t\r\n\t}\r\n\t\r\n\thandleClose = () => this.setState({show:false});\r\n   handleShow = () => this.setState({show:true});\t\r\n   selectScenario = (scenario) => {\r\n\t   this.props.data.selectScenario(scenario);\r\n\t   this.handleClose();\r\n   }\r\n\t\r\n  render() {\r\n    return  <>\r\n    \t\t\r\n\t\t    <div id=\"currentInfo\">\r\n\t\t  \t\r\n\t\t\t <Button variant=\"outline-light\" size=\"sm\" onClick={this.handleShow}> \r\n\t\t\t \tScenario\r\n\t\t      </Button>\r\n\t\t\t\r\n\t\t\t\r\n\t\t  </div>\r\n\t\t\r\n\t\t\r\n\t\t  <Modal show={this.state.show} onHide={this.handleClose}>\r\n\t        <Modal.Header closeButton>\r\n\t          <Modal.Title>Select Scenario</Modal.Title>\r\n\t        </Modal.Header>\r\n\t        <Modal.Body>\r\n\t        \r\n\t        <Tabs variant=\"pills\" defaultActiveKey=\"pills-ancient\">\r\n\t\t        <Tab eventKey=\"pills-ancient\" title=\"Ancient\">\r\n\t\t        \t{this.props.data.era.ancient.map(scenario=>{\r\n\t\t        \t\tif(scenario.yn)\r\n\t\t        \t\t\treturn <div onClick={() =>this.selectScenario(scenario)}><hr/><a href=\"#\" >{scenario.name}</a></div>\r\n\t\t        \t\t\telse return null;\r\n\t\t        \t})}\r\n\t\t        </Tab>\r\n\t\t        <Tab eventKey=\"pills-classical\" title=\"Classical\">\r\n\t\t        \t{this.props.data.era.classical.map(scenario=>{\r\n\t\t        \t\tif(scenario.yn)\r\n\t\t        \t\t\treturn <div onClick={() =>this.selectScenario(scenario)}><hr/><a href=\"#\">{scenario.name}</a></div>\r\n\t\t        \t\t\telse return null;\r\n\t\t        \t})}\r\n\t\t\t       \r\n\t\t        </Tab>\r\n\t\t        <Tab eventKey=\"pills-medieval\" title=\"Medieval\">\r\n\t\t\t        {this.props.data.era.medieval.map(scenario=>{\r\n\t\t        \t\tif(scenario.yn)\r\n\t\t        \t\t\treturn <div onClick={() =>this.selectScenario(scenario)}><hr/><a href=\"#\">{scenario.name}</a></div>\r\n\t\t        \t\t\telse return null;\r\n\t\t        \t})}\r\n\t\t        </Tab>\r\n\t\t        <Tab eventKey=\"pills-renaissance\" title=\"Renaissance\">\r\n\t\t\t        {this.props.data.era.renaissance.map(scenario=>{\r\n\t\t        \t\tif(scenario.yn)\r\n\t\t        \t\t\treturn <div onClick={() =>this.selectScenario(scenario)}><hr/><a href=\"#\">{scenario.name}</a></div>\r\n\t\t        \t\t\telse return null;\r\n\t\t        \t})}\r\n\t\t        </Tab>\r\n\r\n\t\t      \r\n\t\t        \r\n\t\t      </Tabs>\r\n\t        \r\n\t        \r\n\t        </Modal.Body>\r\n\r\n\t      </Modal>\r\n\t      \r\n\t      \r\n\t</>;\r\n\r\n   \r\n  }\r\n}","import React, { useState } from 'react';\nimport './App.css';\nimport ThreeScene from './ThreeScene.js';\nimport DataService from './DataService.js';\nimport Main from './Main.js';\n\nimport './css/bootstrap.css';\nimport './css/glyphicon.css';\n\n\nfunction App() {\n\n\tconst scene = React.createRef();\n\tconst data = new DataService(scene);\n\t\n\n  return (\t\t  \n\t\t  <>\n\t\t  \t<ThreeScene ref={scene}/>\n\t\t\t <Main data={data}/>\n\t\t\t  \n\t\t\t  \n\t\t      \n\t\t      \n\t\t  </>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}